<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Pytokei, calling rust's tokei from python | Agus site</title><meta name=keywords content="Python,Rust"><meta name=description content="In this blog post I will walk through the steps I followed to start with rust, what resulted in pytokei, a python wrapper of tokei.
❯ pytokei pytokei pytokei ┏━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━┳━━━━━━━━━━┳━━━━━━━━┓ ┃ language ┃ Files ┃ Lines ┃ Code ┃ Comments ┃ Blanks ┃ ┡━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━╇━━━━━━━━━━╇━━━━━━━━┩ │ Rust │ 9 │ 1011 │ 846 │ 49 │ 116 │ │ Python │ 5 │ 568 │ 436 │ 13 │ 119 │ │ Markdown │ 11 │ 423 │ 123 │ 179 │ 121 │ │ Plain Text │ 4 │ 133 │ 0 │ 133 │ 0 │ │ TOML │ 3 │ 75 │ 59 │ 6 │ 10 │ │ YAML │ 1 │ 69 │ 63 │ 0 │ 6 │ │ Makefile │ 1 │ 26 │ 18 │ 0 │ 8 │ │ Dockerfile │ 1 │ 16 │ 7 │ 3 │ 6 │ │ Shell │ 3 │ 12 │ 12 │ 0 │ 0 │ │ Autoconf │ 3 │ 7 │ 7 │ 0 │ 0 │ └────────────┴───────┴───────┴──────┴──────────┴────────┘ Intro After reading Rust&rsquo;s book, I was looking for a excuse to build something in Rust."><meta name=author content><link rel=canonical href=https://plaguss.github.io/blog/my-attempt-of-calling-rust-from-python/><link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://plaguss.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://plaguss.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://plaguss.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://plaguss.github.io/apple-touch-icon.png><link rel=mask-icon href=https://plaguss.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://plaguss.github.io/blog/my-attempt-of-calling-rust-from-python/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Pytokei, calling rust's tokei from python"><meta property="og:description" content="In this blog post I will walk through the steps I followed to start with rust, what resulted in pytokei, a python wrapper of tokei.
❯ pytokei pytokei pytokei ┏━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━┳━━━━━━━━━━┳━━━━━━━━┓ ┃ language ┃ Files ┃ Lines ┃ Code ┃ Comments ┃ Blanks ┃ ┡━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━╇━━━━━━━━━━╇━━━━━━━━┩ │ Rust │ 9 │ 1011 │ 846 │ 49 │ 116 │ │ Python │ 5 │ 568 │ 436 │ 13 │ 119 │ │ Markdown │ 11 │ 423 │ 123 │ 179 │ 121 │ │ Plain Text │ 4 │ 133 │ 0 │ 133 │ 0 │ │ TOML │ 3 │ 75 │ 59 │ 6 │ 10 │ │ YAML │ 1 │ 69 │ 63 │ 0 │ 6 │ │ Makefile │ 1 │ 26 │ 18 │ 0 │ 8 │ │ Dockerfile │ 1 │ 16 │ 7 │ 3 │ 6 │ │ Shell │ 3 │ 12 │ 12 │ 0 │ 0 │ │ Autoconf │ 3 │ 7 │ 7 │ 0 │ 0 │ └────────────┴───────┴───────┴──────┴──────────┴────────┘ Intro After reading Rust&rsquo;s book, I was looking for a excuse to build something in Rust."><meta property="og:type" content="article"><meta property="og:url" content="https://plaguss.github.io/blog/my-attempt-of-calling-rust-from-python/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-04-09T20:38:54+01:00"><meta property="article:modified_time" content="2023-04-09T20:38:54+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pytokei, calling rust's tokei from python"><meta name=twitter:description content="In this blog post I will walk through the steps I followed to start with rust, what resulted in pytokei, a python wrapper of tokei.
❯ pytokei pytokei pytokei ┏━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━┳━━━━━━━━━━┳━━━━━━━━┓ ┃ language ┃ Files ┃ Lines ┃ Code ┃ Comments ┃ Blanks ┃ ┡━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━╇━━━━━━━━━━╇━━━━━━━━┩ │ Rust │ 9 │ 1011 │ 846 │ 49 │ 116 │ │ Python │ 5 │ 568 │ 436 │ 13 │ 119 │ │ Markdown │ 11 │ 423 │ 123 │ 179 │ 121 │ │ Plain Text │ 4 │ 133 │ 0 │ 133 │ 0 │ │ TOML │ 3 │ 75 │ 59 │ 6 │ 10 │ │ YAML │ 1 │ 69 │ 63 │ 0 │ 6 │ │ Makefile │ 1 │ 26 │ 18 │ 0 │ 8 │ │ Dockerfile │ 1 │ 16 │ 7 │ 3 │ 6 │ │ Shell │ 3 │ 12 │ 12 │ 0 │ 0 │ │ Autoconf │ 3 │ 7 │ 7 │ 0 │ 0 │ └────────────┴───────┴───────┴──────┴──────────┴────────┘ Intro After reading Rust&rsquo;s book, I was looking for a excuse to build something in Rust."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://plaguss.github.io/blog/"},{"@type":"ListItem","position":2,"name":"Pytokei, calling rust's tokei from python","item":"https://plaguss.github.io/blog/my-attempt-of-calling-rust-from-python/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Pytokei, calling rust's tokei from python","name":"Pytokei, calling rust\u0027s tokei from python","description":"In this blog post I will walk through the steps I followed to start with rust, what resulted in pytokei, a python wrapper of tokei.\n❯ pytokei pytokei pytokei ┏━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━┳━━━━━━━━━━┳━━━━━━━━┓ ┃ language ┃ Files ┃ Lines ┃ Code ┃ Comments ┃ Blanks ┃ ┡━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━╇━━━━━━━━━━╇━━━━━━━━┩ │ Rust │ 9 │ 1011 │ 846 │ 49 │ 116 │ │ Python │ 5 │ 568 │ 436 │ 13 │ 119 │ │ Markdown │ 11 │ 423 │ 123 │ 179 │ 121 │ │ Plain Text │ 4 │ 133 │ 0 │ 133 │ 0 │ │ TOML │ 3 │ 75 │ 59 │ 6 │ 10 │ │ YAML │ 1 │ 69 │ 63 │ 0 │ 6 │ │ Makefile │ 1 │ 26 │ 18 │ 0 │ 8 │ │ Dockerfile │ 1 │ 16 │ 7 │ 3 │ 6 │ │ Shell │ 3 │ 12 │ 12 │ 0 │ 0 │ │ Autoconf │ 3 │ 7 │ 7 │ 0 │ 0 │ └────────────┴───────┴───────┴──────┴──────────┴────────┘ Intro After reading Rust\u0026rsquo;s book, I was looking for a excuse to build something in Rust.","keywords":["Python","Rust"],"articleBody":"In this blog post I will walk through the steps I followed to start with rust, what resulted in pytokei, a python wrapper of tokei.\n❯ pytokei pytokei pytokei ┏━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━┳━━━━━━━━━━┳━━━━━━━━┓ ┃ language ┃ Files ┃ Lines ┃ Code ┃ Comments ┃ Blanks ┃ ┡━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━╇━━━━━━━━━━╇━━━━━━━━┩ │ Rust │ 9 │ 1011 │ 846 │ 49 │ 116 │ │ Python │ 5 │ 568 │ 436 │ 13 │ 119 │ │ Markdown │ 11 │ 423 │ 123 │ 179 │ 121 │ │ Plain Text │ 4 │ 133 │ 0 │ 133 │ 0 │ │ TOML │ 3 │ 75 │ 59 │ 6 │ 10 │ │ YAML │ 1 │ 69 │ 63 │ 0 │ 6 │ │ Makefile │ 1 │ 26 │ 18 │ 0 │ 8 │ │ Dockerfile │ 1 │ 16 │ 7 │ 3 │ 6 │ │ Shell │ 3 │ 12 │ 12 │ 0 │ 0 │ │ Autoconf │ 3 │ 7 │ 7 │ 0 │ 0 │ └────────────┴───────┴───────┴──────┴──────────┴────────┘ Intro After reading Rust’s book, I was looking for a excuse to build something in Rust. Just by taking a look at the book’s index, one starts to wonder what to begin with…\nGiven that I’m comfortable enough with python, I tought it could be easy to write some bindings for a simple library already written in rust, so that I had some familiarity. By looking at PyO3 examples I found a simple library that could help as a simple guide: pyheck. Now its just a matter of finding a library to wrap.\nTo learn how to write bindings to rust from python its better for you to take a look at maturin and PyO3, here I just share my journey, but its not intented as a full guide to anything.\nPytokei Thinking about a good target library, I remembered a library I found tokei by chance some time ago. It seemed that exposing the public API to python should not be so hard.\nTokei From its readme:\nTokei is a program that displays statistics about your code. Tokei will show the number of files, total lines within those files and code, comments, and blanks grouped by language.\nIt is a simple command line program, but to expose to python what it does, we have to wrap as functions and or classes the contents of lib.rs, we don’t need anything about its CLI.\nDevelopment You can take a lookg at the development section of pytokei’s docs to get started. We just need to install maturin to create the package, and PyO3 to create the bindings.\nTo package the code we need a Cargo.toml for the rust and a pyproject.toml for python, all of which is controlled by maturin.\nSo… I just want to mimic the behavior of tokei’s API, let’s see what we need to implement for that end.\nRust The public API of pytokei can be seen at the lib.rs file. Lets take a look at what we will have visible from python:\n#[pymodule] fn _pytokei(_py: Python, m: \u0026PyModule) -\u003e PyResult\u003c()\u003e { let version = env!(\"CARGO_PKG_VERSION\").to_string(); m.add(\"__version__\", version)?; m.add_class::\u003cPyConfig\u003e().unwrap(); m.add_class::\u003cPyLanguages\u003e().unwrap(); m.add_class::\u003cPySort\u003e().unwrap(); m.add_function(wrap_pyfunction!(sort_types, m)?)?; m.add_class::\u003cPyCodeStats\u003e().unwrap(); m.add_class::\u003cPyReport\u003e().unwrap(); m.add_class::\u003cPyLanguageType\u003e().unwrap(); m.add_class::\u003cPyLanguage\u003e().unwrap(); Ok(()) } We can read from the previous snippet that we have a module called _pytokei, along with some classes: PyConfig, PyLanguages… and a single function sort_types. How do they look like in rust?\nTake a look at the implementation of the main class:\n#[pyclass(name = \"Languages\")] pub struct PyLanguages { pub languages: Languages, } Its just a wrapper of the Languages struct from tokei, with the pyclass attribute from PyO3 to make it a python class, which for this case works much like a python decorator.\nLets see now some of the methods:\n#[pymethods] impl PyLanguages { #[new] pub fn new() -\u003e Self { PyLanguages { languages: Languages::new(), } } pub fn get_statistics(\u0026mut self, paths: Vec\u003cString\u003e, ignored: Vec\u003cString\u003e, config: \u0026PyConfig) { let paths_: Vec\u003c\u0026str\u003e = paths.iter().map(String::as_str).collect(); let paths_ = paths_.as_slice(); let ignored_: Vec\u003c\u0026str\u003e = ignored.iter().map(String::as_str).collect(); let ignored_ = ignored_.as_slice(); self.languages .get_statistics(\u0026paths_, \u0026ignored_, \u0026config.config) } pub fn total(\u0026self) -\u003e PyLanguage { PyLanguage { language: self.languages.total(), } } pub fn language_names(\u0026self) -\u003e PyResult\u003cVec\u003c\u0026str\u003e\u003e { let vec = self .languages .iter() .map(|(lang_type, _)| lang_type.name()) .collect(); Ok(vec) } ... It is just a matter of exposing the rust content to python, easy for this type of methods:\nnew: Initializes the PyLanguages struct, does the job of the python constructor (__init__).\nget_statistics: It just parses the arguments to pass them to the get_statistics method from rust, doesn’t return anything as the result is internally stored.\ntotal: Returns a PyLanguage in python with the result from an internal method.\nlanguage_names: Creates and returns a Vec of \u0026str, which is automatically translated by PyO3 to a list of str in python.\nWe can practice rust one function at a time. For a simple case like this we just need to find how to expose the rust chunk of code to python, we don’t need to get into nothing much complicated.\nLet’s see now the what the python version looks like.\nPython API From the python side, given the library is simple enough, we just have to write the type stubs in a .pyi file: _pytokei.pyi for our case. There we can see all python code, as well as the docstrings, deployed at API docs.\nThe python interface to the PyLanguage struct from rust can be seen here:\nclass Languages: \"\"\"A class representing a list of languages counted in the provided directory. See [`LanguageType.list`](language_type.md) Examples -------- ```python \u003e\u003e\u003e from pytokei import Languages \u003e\u003e\u003e langs = Languages() \u003e\u003e\u003e langs Languages() ``` References ---------- [Languages implementation](https://docs.rs/tokei/latest/tokei/struct.Languages.html#impl) \"\"\" def __init__(self) -\u003e None: ... def get_statistics( self, paths: list[str], ignored: list[str], config: Config ) -\u003e None: \"\"\"Populates the Languages struct with statistics about languages provided by Language. Takes a list of of paths (as str) to recursively traverse, paths can be relative, absolute or glob paths. A second list of paths (as str) to ignore, these strings use the `.gitignore` syntax, such as `target` or `**/*.bk`. Parameters ---------- paths : list[str] List of files to traverse. It may be a single directory. ignored : list[str] List of files to ignore. If you don't want anything ignored, just pass `[\"ignored\"]`. config : Config Config instance. If you dont have any preferences, just pass `Config`. \"\"\" def total(self) -\u003e Language: \"\"\"Summary of the Languages struct.\"\"\" def language_names(self) -\u003e Optional[list[str]]: \"\"\"Returns the list of language names, if any was found.\"\"\" ... It doesn’t contain the actual implementation, just the skeleton, enough for an IDE to help us with the autocompletion.\nLets see an example running pytokei against pip:\n$ python \u003e\u003e\u003e import pytokei \u003e\u003e\u003e from rich import print \u003e\u003e\u003e langs = pytokei.Languages() \u003e\u003e\u003e langs.get_statistics([\".\"], [\"nothing\"], pytokei.Config()) \u003e\u003e\u003e print(langs.report_compact_plain()) { 'TOML': {'blanks': 14, 'comments': 15, 'files': 17, 'lines': 162, 'code': 133}, 'ReStructuredText': {'comments': 0, 'files': 78, 'code': 7126, 'lines': 9702, 'blanks': 2576}, 'C': {'code': 0, 'comments': 0, 'blanks': 0, 'files': 1, 'lines': 0}, 'Markdown': {'blanks': 861, 'files': 27, 'comments': 2243, 'lines': 3408, 'code': 304}, 'PowerShell': {'files': 1, 'lines': 74, 'comments': 2, 'blanks': 11, 'code': 61}, 'Python': {'lines': 220272, 'files': 709, 'code': 188695, 'blanks': 22068, 'comments': 9509}, 'Autoconf': {'comments': 0, 'lines': 50, 'code': 44, 'blanks': 6, 'files': 10}, 'Plain Text': {'lines': 1293, 'files': 18, 'blanks': 96, 'code': 0, 'comments': 1197}, 'HTML': {'code': 77, 'comments': 0, 'blanks': 0, 'lines': 77, 'files': 11} } We are obtaining the statistics from the current working directory (in my case I was in the folder containing pip), we filter “nothing” (this is just a placeholder, no file or folder is called like that, so it works), and use the default Config, and we print the compact report, meaning we print the statistics at the language level.\nYou can see the equivalent example from tokei at docs.rs.\nPython CLI pytokei also exposes a python API and a cli which shows the results in the console similar to what tokei does, but using rich. This is just an extra to mimic to obtain a similar command line interface to the one tokei gives us, but there is no more rust involved in this step.\nThe following block shows the result of running the program from the console against pip:\n❯ pytokei pip pip ┏━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┓ ┃ language ┃ Files ┃ Lines ┃ Code ┃ Comments ┃ Blanks ┃ ┡━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━┩ │ Python │ 709 │ 220272 │ 188695 │ 9509 │ 22068 │ │ ReStructuredText │ 78 │ 9702 │ 7126 │ 0 │ 2576 │ │ Markdown │ 27 │ 3408 │ 304 │ 2243 │ 861 │ │ Plain Text │ 18 │ 1293 │ 0 │ 1197 │ 96 │ │ TOML │ 17 │ 162 │ 133 │ 15 │ 14 │ │ HTML │ 11 │ 77 │ 77 │ 0 │ 0 │ │ PowerShell │ 1 │ 74 │ 61 │ 2 │ 11 │ │ Autoconf │ 10 │ 50 │ 44 │ 0 │ 6 │ │ C │ 1 │ 0 │ 0 │ 0 │ 0 │ └──────────────────┴───────┴────────┴────────┴──────────┴────────┘ Conclusion Its just a simple library, but it help me gain some confidence not only writing rust, but also reading an proper rust project, how to wrap it in python using PyO3 and maturin, and upload the final result to PyPI.\nYou can visit the github repository at pytokei as well as the documentation.\n","wordCount":"1562","inLanguage":"en","datePublished":"2023-04-09T20:38:54+01:00","dateModified":"2023-04-09T20:38:54+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://plaguss.github.io/blog/my-attempt-of-calling-rust-from-python/"},"publisher":{"@type":"Organization","name":"Agus site","logo":{"@type":"ImageObject","url":"https://plaguss.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://plaguss.github.io/ accesskey=h title="Agus site (Alt + H)">Agus site</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://plaguss.github.io/es/ title=Español aria-label=Español>Es</a></li></ul></div></div><ul id=menu><li><a href=https://plaguss.github.io/ title=Blog><span>Blog</span></a></li><li><a href=https://plaguss.github.io/home/ title=Home><span>Home</span></a></li><li><a href=https://plaguss.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://plaguss.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Pytokei, calling rust's tokei from python</h1><div class=post-meta><span title='2023-04-09 20:38:54 +0100 +0100'>April 9, 2023</span>&nbsp;·&nbsp;8 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#intro aria-label=Intro>Intro</a></li><li><a href=#pytokei aria-label=Pytokei>Pytokei</a><ul><li><a href=#tokei aria-label=Tokei>Tokei</a></li><li><a href=#development aria-label=Development>Development</a><ul><li><a href=#rust aria-label=Rust>Rust</a></li><li><a href=#python-api aria-label="Python API">Python API</a></li><li><a href=#python-cli aria-label="Python CLI">Python CLI</a></li></ul></li></ul></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></details></div><div class=post-content><p>In this blog post I will walk through the steps I followed to start with rust, what resulted in <a href=https://github.com/plaguss/pytokei>pytokei</a>, a python wrapper of <a href=https://github.com/XAMPPRocky/tokei/tree/master>tokei</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>❯ pytokei pytokei
</span></span></span><span class=line><span class=cl><span class=go>                        pytokei                         
</span></span></span><span class=line><span class=cl><span class=go>┏━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━┳━━━━━━━━━━┳━━━━━━━━┓
</span></span></span><span class=line><span class=cl><span class=go>┃ language   ┃ Files ┃ Lines ┃ Code ┃ Comments ┃ Blanks ┃
</span></span></span><span class=line><span class=cl><span class=go>┡━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━╇━━━━━━━━━━╇━━━━━━━━┩
</span></span></span><span class=line><span class=cl><span class=go>│ Rust       │     9 │  1011 │  846 │       49 │    116 │
</span></span></span><span class=line><span class=cl><span class=go>│ Python     │     5 │   568 │  436 │       13 │    119 │
</span></span></span><span class=line><span class=cl><span class=go>│ Markdown   │    11 │   423 │  123 │      179 │    121 │
</span></span></span><span class=line><span class=cl><span class=go>│ Plain Text │     4 │   133 │    0 │      133 │      0 │
</span></span></span><span class=line><span class=cl><span class=go>│ TOML       │     3 │    75 │   59 │        6 │     10 │
</span></span></span><span class=line><span class=cl><span class=go>│ YAML       │     1 │    69 │   63 │        0 │      6 │
</span></span></span><span class=line><span class=cl><span class=go>│ Makefile   │     1 │    26 │   18 │        0 │      8 │
</span></span></span><span class=line><span class=cl><span class=go>│ Dockerfile │     1 │    16 │    7 │        3 │      6 │
</span></span></span><span class=line><span class=cl><span class=go>│ Shell      │     3 │    12 │   12 │        0 │      0 │
</span></span></span><span class=line><span class=cl><span class=go>│ Autoconf   │     3 │     7 │    7 │        0 │      0 │
</span></span></span><span class=line><span class=cl><span class=go>└────────────┴───────┴───────┴──────┴──────────┴────────┘
</span></span></span></code></pre></div><h2 id=intro>Intro<a hidden class=anchor aria-hidden=true href=#intro>#</a></h2><p>After reading <a href=https://doc.rust-lang.org/stable/book/>Rust&rsquo;s book</a>, I was looking for a excuse to build something in Rust. Just by taking a look at the book&rsquo;s index, one starts to wonder what to begin with&mldr;</p><p>Given that I&rsquo;m comfortable enough with <em>python</em>, I tought it could be easy to
write some bindings for a simple library already written in rust, so that I had some familiarity. By looking at <a href=https://github.com/PyO3/pyo3#examples>PyO3 examples</a> I found a simple library that could help as a simple guide: <a href=https://github.com/kevinheavey/pyheck>pyheck</a>. Now its just a matter of finding a library to wrap.</p><p>To learn how to write bindings to rust from <em>python</em> its better for you to take a look at <a href=https://www.maturin.rs/>maturin</a> and <a href=https://pyo3.rs/v0.19.1/class>PyO3</a>, here I just share my journey, but its not intented as a full guide to anything.</p><h2 id=pytokei>Pytokei<a hidden class=anchor aria-hidden=true href=#pytokei>#</a></h2><p>Thinking about a good target library, I remembered a library I found <a href=https://github.com/XAMPPRocky/tokei/tree/master>tokei</a> by chance some time ago. It seemed that exposing the public API to <em>python</em> should not be so hard.</p><h3 id=tokei>Tokei<a hidden class=anchor aria-hidden=true href=#tokei>#</a></h3><p>From its readme:</p><p><code>Tokei is a program that displays statistics about your code. Tokei will show the number of files, total lines within those files and code, comments, and blanks grouped by language.</code></p><p>It is a simple command line program, but to expose to <em>python</em> what it does, we have to wrap as functions and or classes the contents of <a href=https://github.com/XAMPPRocky/tokei/blob/master/src/lib.rs>lib.rs</a>, we don&rsquo;t need anything about its CLI.</p><h3 id=development>Development<a hidden class=anchor aria-hidden=true href=#development>#</a></h3><p>You can take a lookg at the <a href=https://plaguss.github.io/pytokei/#development>development</a> section of pytokei&rsquo;s docs to get started. We just need to install <a href=https://www.maturin.rs/>maturin</a> to create the package, and <a href=https://pyo3.rs/v0.19.1/>PyO3</a> to create the bindings.</p><p>To package the code we need a <a href=https://github.com/plaguss/pytokei/blob/main/Cargo.toml>Cargo.toml</a> for the rust and a <a href=https://github.com/plaguss/pytokei/blob/main/pyproject.toml>pyproject.toml</a> for <em>python</em>, all of which is controlled by <code>maturin</code>.</p><p>So&mldr; I just want to mimic the behavior of <code>tokei</code>&rsquo;s API, let&rsquo;s see what we need to implement for that end.</p><h4 id=rust>Rust<a hidden class=anchor aria-hidden=true href=#rust>#</a></h4><p>The public API of <code>pytokei</code> can be seen at the <a href=https://github.com/plaguss/pytokei/blob/main/src/lib.rs>lib.rs</a> file. Lets take a look at what we will have visible from <em>python</em>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[pymodule]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>_pytokei</span><span class=p>(</span><span class=n>_py</span>: <span class=nc>Python</span><span class=p>,</span><span class=w> </span><span class=n>m</span>: <span class=kp>&amp;</span><span class=nc>PyModule</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>PyResult</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=fm>env!</span><span class=p>(</span><span class=s>&#34;CARGO_PKG_VERSION&#34;</span><span class=p>).</span><span class=n>to_string</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>m</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=s>&#34;__version__&#34;</span><span class=p>,</span><span class=w> </span><span class=n>version</span><span class=p>)</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>m</span><span class=p>.</span><span class=n>add_class</span>::<span class=o>&lt;</span><span class=n>PyConfig</span><span class=o>&gt;</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>m</span><span class=p>.</span><span class=n>add_class</span>::<span class=o>&lt;</span><span class=n>PyLanguages</span><span class=o>&gt;</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>m</span><span class=p>.</span><span class=n>add_class</span>::<span class=o>&lt;</span><span class=n>PySort</span><span class=o>&gt;</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>m</span><span class=p>.</span><span class=n>add_function</span><span class=p>(</span><span class=fm>wrap_pyfunction!</span><span class=p>(</span><span class=n>sort_types</span><span class=p>,</span><span class=w> </span><span class=n>m</span><span class=p>)</span><span class=o>?</span><span class=p>)</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>m</span><span class=p>.</span><span class=n>add_class</span>::<span class=o>&lt;</span><span class=n>PyCodeStats</span><span class=o>&gt;</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>m</span><span class=p>.</span><span class=n>add_class</span>::<span class=o>&lt;</span><span class=n>PyReport</span><span class=o>&gt;</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>m</span><span class=p>.</span><span class=n>add_class</span>::<span class=o>&lt;</span><span class=n>PyLanguageType</span><span class=o>&gt;</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>m</span><span class=p>.</span><span class=n>add_class</span>::<span class=o>&lt;</span><span class=n>PyLanguage</span><span class=o>&gt;</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Ok</span><span class=p>(())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>We can read from the previous snippet that we have a module called <code>_pytokei</code>, along with some classes: <code>PyConfig</code>, <code>PyLanguages</code>&mldr; and a single function <code>sort_types</code>. How do they look like in <em>rust</em>?</p><p>Take a look at the implementation of the main class:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[pyclass(name = </span><span class=s>&#34;Languages&#34;</span><span class=cp>)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>PyLanguages</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>languages</span>: <span class=nc>Languages</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Its just a wrapper of the <code>Languages</code> struct from <code>tokei</code>, with the <em>pyclass</em> attribute from PyO3 to make it a <em>python</em> class, which for this case works much like a <em>python</em> <em>decorator</em>.</p><p>Lets see now some of the methods:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[pymethods]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>PyLanguages</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[new]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>new</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PyLanguages</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>languages</span>: <span class=nc>Languages</span>::<span class=n>new</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>get_statistics</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>paths</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>ignored</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>config</span>: <span class=kp>&amp;</span><span class=nc>PyConfig</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>paths_</span>: <span class=nb>Vec</span><span class=o>&lt;&amp;</span><span class=kt>str</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paths</span><span class=p>.</span><span class=n>iter</span><span class=p>().</span><span class=n>map</span><span class=p>(</span><span class=nb>String</span>::<span class=n>as_str</span><span class=p>).</span><span class=n>collect</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>paths_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paths_</span><span class=p>.</span><span class=n>as_slice</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>ignored_</span>: <span class=nb>Vec</span><span class=o>&lt;&amp;</span><span class=kt>str</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ignored</span><span class=p>.</span><span class=n>iter</span><span class=p>().</span><span class=n>map</span><span class=p>(</span><span class=nb>String</span>::<span class=n>as_str</span><span class=p>).</span><span class=n>collect</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>ignored_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ignored_</span><span class=p>.</span><span class=n>as_slice</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>languages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>get_statistics</span><span class=p>(</span><span class=o>&amp;</span><span class=n>paths_</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>ignored_</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>config</span><span class=p>.</span><span class=n>config</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>total</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>PyLanguage</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PyLanguage</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>language</span>: <span class=nc>self</span><span class=p>.</span><span class=n>languages</span><span class=p>.</span><span class=n>total</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>language_names</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>PyResult</span><span class=o>&lt;</span><span class=nb>Vec</span><span class=o>&lt;&amp;</span><span class=kt>str</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>vec</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>self</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>languages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>iter</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=p>(</span><span class=n>lang_type</span><span class=p>,</span><span class=w> </span><span class=n>_</span><span class=p>)</span><span class=o>|</span><span class=w> </span><span class=n>lang_type</span><span class=p>.</span><span class=n>name</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>collect</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>vec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span></code></pre></div><p>It is just a matter of exposing the rust content to <em>python</em>, easy for this type of methods:</p><ul><li><p><code>new</code>: Initializes the <code>PyLanguages</code> struct, does the job of the <em>python</em> constructor (<code>__init__</code>).</p></li><li><p><code>get_statistics</code>: It just parses the arguments to pass them to the <code>get_statistics</code> method from rust, doesn&rsquo;t return anything as the result is internally stored.</p></li><li><p><code>total</code>: Returns a <code>PyLanguage</code> in <em>python</em> with the result from an internal method.</p></li><li><p><code>language_names</code>: Creates and returns a <em>Vec</em> of <em>&amp;str</em>, which is automatically translated by <em>PyO3</em> to a <em>list</em> of <em>str</em> in <em>python</em>.</p></li></ul><p>We can practice rust one function at a time. For a simple case like this we just need to find how to expose the rust chunk of code to python, we don&rsquo;t need to get into nothing much complicated.</p><p>Let&rsquo;s see now the what the <em>python</em> version looks like.</p><h4 id=python-api>Python API<a hidden class=anchor aria-hidden=true href=#python-api>#</a></h4><p>From the <em>python</em> side, given the library is simple enough, we just have to write the type stubs in a .pyi file: <a href=https://github.com/plaguss/pytokei/blob/main/pytokei/_pytokei.pyi>_pytokei.pyi</a> for our case. There we can see all <em>python</em> code, as well as the docstrings, deployed at <a href=https://plaguss.github.io/pytokei/api/languages/>API docs</a>.</p><p>The <em>python</em> interface to the <code>PyLanguage</code> struct from rust can be seen here:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Languages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;A class representing a list of languages counted in the provided directory.
</span></span></span><span class=line><span class=cl><span class=s2>    See [`LanguageType.list`](language_type.md)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Examples
</span></span></span><span class=line><span class=cl><span class=s2>    --------
</span></span></span><span class=line><span class=cl><span class=s2>        ```python
</span></span></span><span class=line><span class=cl><span class=s2>        &gt;&gt;&gt; from pytokei import Languages
</span></span></span><span class=line><span class=cl><span class=s2>        &gt;&gt;&gt; langs = Languages()
</span></span></span><span class=line><span class=cl><span class=s2>        &gt;&gt;&gt; langs
</span></span></span><span class=line><span class=cl><span class=s2>        Languages()
</span></span></span><span class=line><span class=cl><span class=s2>        ```
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    References
</span></span></span><span class=line><span class=cl><span class=s2>    ----------
</span></span></span><span class=line><span class=cl><span class=s2>    [Languages implementation](https://docs.rs/tokei/latest/tokei/struct.Languages.html#impl)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_statistics</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=p>,</span> <span class=n>paths</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>ignored</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>config</span><span class=p>:</span> <span class=n>Config</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Populates the Languages struct with statistics about languages provided by Language.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Takes a list of of paths (as str) to recursively traverse, paths can be relative,
</span></span></span><span class=line><span class=cl><span class=s2>        absolute or glob paths.
</span></span></span><span class=line><span class=cl><span class=s2>        A second list of paths (as str) to ignore, these strings use the `.gitignore` syntax,
</span></span></span><span class=line><span class=cl><span class=s2>        such as `target` or `**/*.bk`.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Parameters
</span></span></span><span class=line><span class=cl><span class=s2>        ----------
</span></span></span><span class=line><span class=cl><span class=s2>            paths : list[str]
</span></span></span><span class=line><span class=cl><span class=s2>                List of files to traverse. It may be a single directory.
</span></span></span><span class=line><span class=cl><span class=s2>            ignored : list[str]
</span></span></span><span class=line><span class=cl><span class=s2>                List of files to ignore. If you don&#39;t want anything ignored, just pass `[&#34;ignored&#34;]`.
</span></span></span><span class=line><span class=cl><span class=s2>            config : Config
</span></span></span><span class=line><span class=cl><span class=s2>                Config instance. If you dont have any preferences, just pass `Config`.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>total</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Language</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Summary of the Languages struct.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>language_names</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Returns the list of language names, if any was found.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span></code></pre></div><p>It doesn&rsquo;t contain the actual implementation, just the skeleton, enough for an IDE to help us with the autocompletion.</p><p>Lets see an example running <code>pytokei</code> against <a href=https://github.com/pypa/pip>pip</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=err>$</span> <span class=n>python</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kn>import</span> <span class=nn>pytokei</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>rich</span> <span class=kn>import</span> <span class=nb>print</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>langs</span> <span class=o>=</span> <span class=n>pytokei</span><span class=o>.</span><span class=n>Languages</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>langs</span><span class=o>.</span><span class=n>get_statistics</span><span class=p>([</span><span class=s2>&#34;.&#34;</span><span class=p>],</span> <span class=p>[</span><span class=s2>&#34;nothing&#34;</span><span class=p>],</span> <span class=n>pytokei</span><span class=o>.</span><span class=n>Config</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>print</span><span class=p>(</span><span class=n>langs</span><span class=o>.</span><span class=n>report_compact_plain</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;TOML&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;blanks&#39;</span><span class=p>:</span> <span class=mi>14</span><span class=p>,</span> <span class=s1>&#39;comments&#39;</span><span class=p>:</span> <span class=mi>15</span><span class=p>,</span> <span class=s1>&#39;files&#39;</span><span class=p>:</span> <span class=mi>17</span><span class=p>,</span> <span class=s1>&#39;lines&#39;</span><span class=p>:</span> <span class=mi>162</span><span class=p>,</span> <span class=s1>&#39;code&#39;</span><span class=p>:</span> <span class=mi>133</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;ReStructuredText&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;comments&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;files&#39;</span><span class=p>:</span> <span class=mi>78</span><span class=p>,</span> <span class=s1>&#39;code&#39;</span><span class=p>:</span> <span class=mi>7126</span><span class=p>,</span> <span class=s1>&#39;lines&#39;</span><span class=p>:</span> <span class=mi>9702</span><span class=p>,</span> <span class=s1>&#39;blanks&#39;</span><span class=p>:</span> <span class=mi>2576</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;C&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;code&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;comments&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;blanks&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;files&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;lines&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Markdown&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;blanks&#39;</span><span class=p>:</span> <span class=mi>861</span><span class=p>,</span> <span class=s1>&#39;files&#39;</span><span class=p>:</span> <span class=mi>27</span><span class=p>,</span> <span class=s1>&#39;comments&#39;</span><span class=p>:</span> <span class=mi>2243</span><span class=p>,</span> <span class=s1>&#39;lines&#39;</span><span class=p>:</span> <span class=mi>3408</span><span class=p>,</span> <span class=s1>&#39;code&#39;</span><span class=p>:</span> <span class=mi>304</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;PowerShell&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;files&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;lines&#39;</span><span class=p>:</span> <span class=mi>74</span><span class=p>,</span> <span class=s1>&#39;comments&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> <span class=s1>&#39;blanks&#39;</span><span class=p>:</span> <span class=mi>11</span><span class=p>,</span> <span class=s1>&#39;code&#39;</span><span class=p>:</span> <span class=mi>61</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Python&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;lines&#39;</span><span class=p>:</span> <span class=mi>220272</span><span class=p>,</span> <span class=s1>&#39;files&#39;</span><span class=p>:</span> <span class=mi>709</span><span class=p>,</span> <span class=s1>&#39;code&#39;</span><span class=p>:</span> <span class=mi>188695</span><span class=p>,</span> <span class=s1>&#39;blanks&#39;</span><span class=p>:</span> <span class=mi>22068</span><span class=p>,</span> <span class=s1>&#39;comments&#39;</span><span class=p>:</span> <span class=mi>9509</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Autoconf&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;comments&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;lines&#39;</span><span class=p>:</span> <span class=mi>50</span><span class=p>,</span> <span class=s1>&#39;code&#39;</span><span class=p>:</span> <span class=mi>44</span><span class=p>,</span> <span class=s1>&#39;blanks&#39;</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span> <span class=s1>&#39;files&#39;</span><span class=p>:</span> <span class=mi>10</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Plain Text&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;lines&#39;</span><span class=p>:</span> <span class=mi>1293</span><span class=p>,</span> <span class=s1>&#39;files&#39;</span><span class=p>:</span> <span class=mi>18</span><span class=p>,</span> <span class=s1>&#39;blanks&#39;</span><span class=p>:</span> <span class=mi>96</span><span class=p>,</span> <span class=s1>&#39;code&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;comments&#39;</span><span class=p>:</span> <span class=mi>1197</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;HTML&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;code&#39;</span><span class=p>:</span> <span class=mi>77</span><span class=p>,</span> <span class=s1>&#39;comments&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;blanks&#39;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;lines&#39;</span><span class=p>:</span> <span class=mi>77</span><span class=p>,</span> <span class=s1>&#39;files&#39;</span><span class=p>:</span> <span class=mi>11</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We are obtaining the statistics from the current working directory (in my case I was in the folder containing <code>pip</code>), we filter &ldquo;nothing&rdquo; (this is just a placeholder, no file or folder is called like that, so it works), and use the default <code>Config</code>, and we print the <em>compact report</em>, meaning we print the statistics at the language level.</p><p>You can see the equivalent example from <code>tokei</code> at <a href=https://docs.rs/tokei/9.0.0/tokei/#examples>docs.rs</a>.</p><h4 id=python-cli>Python CLI<a hidden class=anchor aria-hidden=true href=#python-cli>#</a></h4><p><code>pytokei</code> also exposes a <em>python</em> API and a cli which shows the results in the console similar to what <code>tokei</code> does, but using <a href=https://github.com/Textualize/rich>rich</a>. This is just an extra to mimic to obtain a similar command line interface to the one <code>tokei</code> gives us, but there is no more rust involved in this step.</p><p>The following block shows the result of running the program from the console against <code>pip</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>❯ pytokei pip                                                                          
</span></span><span class=line><span class=cl>                               pip                                
</span></span><span class=line><span class=cl>┏━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━┳━━━━━━━━┓
</span></span><span class=line><span class=cl>┃ language         ┃ Files ┃  Lines ┃   Code ┃ Comments ┃ Blanks ┃
</span></span><span class=line><span class=cl>┡━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━╇━━━━━━━━┩
</span></span><span class=line><span class=cl>│ Python           │   <span class=m>709</span> │ <span class=m>220272</span> │ <span class=m>188695</span> │     <span class=m>9509</span> │  <span class=m>22068</span> │
</span></span><span class=line><span class=cl>│ ReStructuredText │    <span class=m>78</span> │   <span class=m>9702</span> │   <span class=m>7126</span> │        <span class=m>0</span> │   <span class=m>2576</span> │
</span></span><span class=line><span class=cl>│ Markdown         │    <span class=m>27</span> │   <span class=m>3408</span> │    <span class=m>304</span> │     <span class=m>2243</span> │    <span class=m>861</span> │
</span></span><span class=line><span class=cl>│ Plain Text       │    <span class=m>18</span> │   <span class=m>1293</span> │      <span class=m>0</span> │     <span class=m>1197</span> │     <span class=m>96</span> │
</span></span><span class=line><span class=cl>│ TOML             │    <span class=m>17</span> │    <span class=m>162</span> │    <span class=m>133</span> │       <span class=m>15</span> │     <span class=m>14</span> │
</span></span><span class=line><span class=cl>│ HTML             │    <span class=m>11</span> │     <span class=m>77</span> │     <span class=m>77</span> │        <span class=m>0</span> │      <span class=m>0</span> │
</span></span><span class=line><span class=cl>│ PowerShell       │     <span class=m>1</span> │     <span class=m>74</span> │     <span class=m>61</span> │        <span class=m>2</span> │     <span class=m>11</span> │
</span></span><span class=line><span class=cl>│ Autoconf         │    <span class=m>10</span> │     <span class=m>50</span> │     <span class=m>44</span> │        <span class=m>0</span> │      <span class=m>6</span> │
</span></span><span class=line><span class=cl>│ C                │     <span class=m>1</span> │      <span class=m>0</span> │      <span class=m>0</span> │        <span class=m>0</span> │      <span class=m>0</span> │
</span></span><span class=line><span class=cl>└──────────────────┴───────┴────────┴────────┴──────────┴────────┘
</span></span></code></pre></div><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Its just a simple library, but it help me gain some confidence not only writing rust, but also reading an proper rust project, how to wrap it in python using <em>PyO3</em> and <em>maturin</em>, and upload the final result to <a href=https://pypi.org/project/pytokei/>PyPI</a>.</p><p>You can visit the github repository at <a href=https://github.com/plaguss/pytokei>pytokei</a> as well as the <a href=https://plaguss.github.io/pytokei/>documentation</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://plaguss.github.io/tags/python/>Python</a></li><li><a href=https://plaguss.github.io/tags/rust/>Rust</a></li></ul><nav class=paginav><a class=next href=https://plaguss.github.io/blog/a-ner-model-for-command-line-help-messages-part2/><span class=title>Next »</span><br><span>A NER Model for Command Line Help Messages (Part 2: spaCy projects to the rescue)</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://plaguss.github.io/>Agus site</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>